# v0.4.0

**Release Date:** TBD

Bug fixes and improved testing infrastructure.

## Highlights

This release fixes JSON decoding errors when the ElevenLabs API returns `null` for nullable fields, and adds integration tests to catch similar issues in the future.

## Bug Fixes

### Fixed: Null Handling in API Responses

Fixed JSON decoding errors when the API returns `null` for nullable `$ref` fields. This affected multiple endpoints including:

- `/v1/voices` - `manual_verification`, `settings`, `sharing` fields
- And 205+ other nullable fields across the API

**Before (error):**
```
decode response: decode GetVoicesResponseModel: callback: decode field "voices":
callback: decode VoiceResponseModel: callback: decode field "fine_tuning":
decode FineTuningResponseModel: callback: decode field "manual_verification":
decode ManualVerificationResponseModel: "{" expected: unexpected byte 110 'n'
```

**After:** Works correctly, `null` values are handled gracefully.

### Root Cause

This was caused by [ogen-go/ogen#1358](https://github.com/ogen-go/ogen/issues/1358) where ogen generates `Opt*` types instead of `OptNil*` types for nullable `$ref` fields in OpenAPI specs.

### Solution

We created [ogen-tools](https://github.com/agentplexus/ogen-tools), a post-processing tool that fixes the generated code:

```bash
# After ogen generation
go run github.com/agentplexus/ogen-tools/cmd/ogen-fixnull@latest internal/api/oas_json_gen.go
```

This is now integrated into the SDK's `generate.sh` script.

## New Features

### Voice Settings Presets

Added pre-configured voice settings for different platforms and use cases:

```go
// Educational platforms
settings := elevenlabs.VoiceSettingsForUdemy()     // Neutral, clear, consistent
settings := elevenlabs.VoiceSettingsForCoursera()  // Slightly expressive, engaging
settings := elevenlabs.VoiceSettingsForEdX()       // Very stable, highly intelligible

// Social media
settings := elevenlabs.VoiceSettingsForInstagram() // Energetic, polished
settings := elevenlabs.VoiceSettingsForTikTok()    // High energy, attention-grabbing
settings := elevenlabs.VoiceSettingsForYouTube()   // Engaging, sustainable for 5-20 min

// Long-form audio
settings := elevenlabs.VoiceSettingsForPodcast()   // Conversational, natural
settings := elevenlabs.VoiceSettingsForAudiobook() // Consistent, easy to listen to
```

See [Voice Settings Presets](../utilities/voicesettings.md) for details on each preset.

### Integration Tests

Added integration tests that run against the real ElevenLabs API to catch null handling and other issues:

```bash
ELEVENLABS_API_KEY=your_key go test -v -tags=integration ./...
```

**Tests added:**

| Test | Endpoint | Purpose |
|------|----------|---------|
| `TestVoicesListNullHandling` | `/v1/voices` | Verifies nullable fields in voice responses |
| `TestModelsListNullHandling` | `/v1/models` | Verifies nullable fields in model responses |
| `TestUserGetNullHandling` | `/v1/user` | Verifies nullable fields in user/subscription |
| `TestHistoryListNullHandling` | `/v1/history` | Verifies nullable fields in history items |

See [Testing Documentation](../contributing/testing.md) for details.

## Developer Experience

### Updated Code Generation

The `generate.sh` script now includes automatic post-processing:

```bash
#!/bin/bash
# generate.sh workflow:
# 1. Convert OpenAPI 3.1 → 3.0.3 (ogen compatibility)
# 2. Run ogen to generate Go code
# 3. Post-process: Fix null handling (ogen-fixnull)  ← NEW
# 4. go mod tidy
# 5. Verify build
```

## Installation

```bash
go get github.com/agentplexus/go-elevenlabs@v0.4.0
```

## Upgrade Notes

This release is backward compatible. The null handling fix resolves errors that previously caused API calls to fail, so existing code should work better without changes.

If you were working around null handling errors with custom code, you can remove those workarounds.
